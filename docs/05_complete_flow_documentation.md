# ğŸ”„ Complete Application Flow Documentation

## Table of Contents
1. [Application Startup](#1-application-startup)
2. [Website Load Flow](#2-website-load-flow)
3. [Explore Page Complete Flow](#3-explore-page-complete-flow)
4. [Stock Detail Page Flow](#4-stock-detail-page-flow)
5. [Buy Order Complete Flow](#5-buy-order-complete-flow)
6. [All API & Cache Usage](#6-all-api--cache-usage)
7. [Complete Caching Strategy](#7-complete-caching-strategy)

---

## 1. Application Startup

### Backend Startup (Spring Boot)

When you run `mvn spring-boot:run`:

```
STEP 1: Spring Boot starts
         â”‚
         â–¼
STEP 2: H2 Database initialized (in-memory)
         â”‚
         â–¼
STEP 3: Hibernate creates tables:
         â€¢ portfolios
         â€¢ holdings
         â€¢ orders
         â€¢ watchlist_items
         â€¢ market_cache
         â”‚
         â–¼
STEP 4: All @Service and @Controller beans initialized
         â”‚
         â–¼
STEP 5: Server ready on http://localhost:8080
```

### Frontend Startup (Vite)

When you run `npm run dev`:

```
STEP 1: Vite starts development server
         â”‚
         â–¼
STEP 2: React app compiles
         â”‚
         â–¼
STEP 3: App available on http://localhost:5173
         â”‚
         â–¼
STEP 4: User opens browser â†’ React Router loads
```

---

## 2. Website Load Flow

### What happens when user opens http://localhost:5173

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WEBSITE INITIAL LOAD                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚   User opens browser                                                          â”‚
â”‚         â”‚                                                                     â”‚
â”‚         â–¼                                                                     â”‚
â”‚   React App loads (App.jsx)                                                   â”‚
â”‚         â”‚                                                                     â”‚
â”‚         â”œâ”€â”€â”€â”€â–º Navbar component mounts                                        â”‚
â”‚         â”‚      â””â”€â”€ InvestmentsRibbon component mounts                        â”‚
â”‚         â”‚          â”‚                                                          â”‚
â”‚         â”‚          â–¼                                                          â”‚
â”‚         â”‚      useEffect runs â†’ Fetches holdings                             â”‚
â”‚         â”‚          â”‚                                                          â”‚
â”‚         â”‚          â”œâ”€â”€ Check sessionStorage cache (5 min)                    â”‚
â”‚         â”‚          â”‚                                                          â”‚
â”‚         â”‚          â”œâ”€â–º [CACHE HIT] â†’ Use cached data                         â”‚
â”‚         â”‚          â”‚                                                          â”‚
â”‚         â”‚          â””â”€â–º [CACHE MISS] â†’ API Call:                              â”‚
â”‚         â”‚                    â”‚                                                â”‚
â”‚         â”‚                    â”œâ”€â”€ GET /api/holdings                           â”‚
â”‚         â”‚                    â”‚                                                â”‚
â”‚         â”‚                    â””â”€â”€ For each holding:                           â”‚
â”‚         â”‚                        GET /api/prices/{ticker}                    â”‚
â”‚         â”‚                                                                     â”‚
â”‚         â””â”€â”€â”€â”€â–º Main content loads based on route                             â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### InvestmentsRibbon API Calls

```javascript
// Frontend checks sessionStorage first
const cacheKey = 'investmentRibbon_cache';
const cached = sessionStorage.getItem(cacheKey);
const cacheTime = sessionStorage.getItem(`${cacheKey}_time`);

if (cached && (Date.now() - cacheTime < 5 * 60 * 1000)) {
    // Use cached data - NO API CALLS
    return JSON.parse(cached);
}

// Cache miss - make API calls
const response = await fetch('/api/holdings');  // â†’ HoldingController â†’ HoldingService â†’ DB
const holdings = await response.json();

for (const holding of holdings) {
    const priceRes = await fetch(`/api/prices/${holding.ticker}`);
    // â†’ PriceController â†’ YahooFinanceService â†’ [In-memory cache OR Yahoo API OR Finnhub]
}
```

---

## 3. Explore Page Complete Flow

### When User Clicks "Explore" Tab

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              EXPLORE PAGE - FULL DATA FLOW                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                             â”‚
â”‚   ExplorePage.jsx mounts                                                                    â”‚
â”‚         â”‚                                                                                   â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚         â”‚                        PARALLEL API CALLS                                 â”‚       â”‚
â”‚         â”‚                                                                           â”‚       â”‚
â”‚         â–¼                     â–¼                     â–¼                     â–¼        â”‚       â”‚
â”‚   MarketPulse.jsx      TrendingStocks.jsx    NewsSection.jsx    IndexTicker.jsx    â”‚       â”‚
â”‚         â”‚                     â”‚                     â”‚                     â”‚         â”‚       â”‚
â”‚         â”‚                     â”‚                     â”‚                     â”‚         â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
          â”‚                     â”‚                     â”‚                     â”‚                  â”‚
          â–¼                     â–¼                     â–¼                     â–¼                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚GET /gainers â”‚      â”‚GET /trendingâ”‚      â”‚ GET /news   â”‚      â”‚GET /indices â”‚            â”‚
    â”‚GET /losers  â”‚      â”‚             â”‚      â”‚             â”‚      â”‚             â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
           â”‚                    â”‚                    â”‚                    â”‚                    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                                                 â”‚                                             â”‚
                                                 â–¼                                             â”‚
                                    MarketDataController                                       â”‚
                                                 â”‚                                             â”‚
                                                 â–¼                                             â”‚
                                    MarketDataService                                          â”‚
                                                 â”‚                                             â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
                              â–¼                                      â–¼                         â”‚
                        getCachedOrFetch()                    getCachedOrFetch()              â”‚
                              â”‚                                      â”‚                         â”‚
                              â–¼                                      â–¼                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
                    â”‚              DATABASE CHECK (market_cache table)            â”‚           â”‚
                    â”‚                                                             â”‚           â”‚
                    â”‚  SELECT * FROM market_cache WHERE cache_key = 'top_gainers'â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                                      â”‚                                                        â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
                         â–¼                         â–¼                                          â”‚
                   [CACHE HIT]              [CACHE MISS]                                      â”‚
                   (< 5 hours old)          (expired or not found)                            â”‚
                         â”‚                         â”‚                                          â”‚
                         â”‚                         â–¼                                          â”‚
                         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
                         â”‚              â”‚  TRY Yahoo Finance  â”‚                               â”‚
                         â”‚              â”‚  YahooFinance.get() â”‚                               â”‚
                         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
                         â”‚                         â”‚                                          â”‚
                         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
                         â”‚              â–¼                     â–¼                               â”‚
                         â”‚         [SUCCESS]             [FAILED/429]                         â”‚
                         â”‚              â”‚                     â”‚                               â”‚
                         â”‚              â”‚                     â–¼                               â”‚
                         â”‚              â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
                         â”‚              â”‚        â”‚  TRY Finnhub API   â”‚                       â”‚
                         â”‚              â”‚        â”‚  finnhub.io/quote  â”‚                       â”‚
                         â”‚              â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                         â”‚              â”‚                  â”‚                                  â”‚
                         â”‚              â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
                         â”‚              â”‚       â–¼                     â–¼                       â”‚
                         â”‚              â”‚  [SUCCESS]             [FAILED]                     â”‚
                         â”‚              â”‚       â”‚                     â”‚                       â”‚
                         â”‚              â”‚       â”‚                     â–¼                       â”‚
                         â”‚              â”‚       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                         â”‚              â”‚       â”‚         â”‚  USE MOCK DATA     â”‚              â”‚
                         â”‚              â”‚       â”‚         â”‚  (Generated)       â”‚              â”‚
                         â”‚              â”‚       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                         â”‚              â”‚       â”‚                   â”‚                         â”‚
                         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
                         â”‚                              â”‚                                     â”‚
                         â”‚                              â–¼                                     â”‚
                         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
                         â”‚              â”‚  SAVE TO DATABASE CACHE          â”‚                   â”‚
                         â”‚              â”‚                                  â”‚                   â”‚
                         â”‚              â”‚  INSERT/UPDATE market_cache      â”‚                   â”‚
                         â”‚              â”‚  SET cache_key = 'top_gainers',  â”‚                   â”‚
                         â”‚              â”‚      cache_value = '[JSON]',     â”‚                   â”‚
                         â”‚              â”‚      updated_at = NOW()          â”‚                   â”‚
                         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                         â”‚                             â”‚                                      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                      â”‚
                                                       â–¼                                      â”‚
                                             Return JSON Response                             â”‚
                                                       â”‚                                      â”‚
                                                       â–¼                                      â”‚
                                              Frontend Receives                               â”‚
                                                       â”‚                                      â”‚
                                                       â–¼                                      â”‚
                                              Display UI Cards                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Explore Page - What Gets Cached Where

| Data | Frontend Cache | Backend In-Memory | Database Cache | From API |
|------|---------------|-------------------|----------------|----------|
| Gainers | sessionStorage 5min | âŒ | market_cache 5hrs | Yahoo â†’ Finnhub |
| Losers | sessionStorage 5min | âŒ | market_cache 5hrs | Yahoo â†’ Finnhub |
| Trending | sessionStorage 5min | âŒ | market_cache 5hrs | Yahoo â†’ Finnhub |
| Indices | sessionStorage 5min | âŒ | market_cache 5hrs | Yahoo â†’ Finnhub |
| News | sessionStorage 5min | âŒ | market_cache 1hr | Yahoo RSS â†’ Finnhub |

---

## 4. Stock Detail Page Flow

### When User Clicks on a Stock (e.g., AAPL)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STOCK DETAIL PAGE - COMPLETE FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                       â”‚
â”‚   User clicks "AAPL" card                                                             â”‚
â”‚         â”‚                                                                             â”‚
â”‚         â–¼                                                                             â”‚
â”‚   React Router navigates to /stock/AAPL                                               â”‚
â”‚         â”‚                                                                             â”‚
â”‚         â–¼                                                                             â”‚
â”‚   StockDetailPage.jsx mounts                                                          â”‚
â”‚         â”‚                                                                             â”‚
â”‚         â–¼                                                                             â”‚
â”‚   useEffect runs with ticker = "AAPL"                                                 â”‚
â”‚         â”‚                                                                             â”‚
â”‚         â”‚  PARALLEL FETCHES:                                                          â”‚
â”‚         â”‚                                                                             â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚         â–¼                  â–¼                  â–¼                  â–¼                   â”‚
â”‚   GET /stock/AAPL    GET /stock/AAPL    GET /news/AAPL     GET /watchlist           â”‚
â”‚      /history                                                check                   â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚                   â”‚
â”‚         â–¼                  â–¼                  â–¼                  â–¼                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                      BACKEND PROCESSING                                       â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚                                                                               â”‚  â”‚
â”‚   â”‚   MarketDataService.getStockWithHistory("AAPL")                              â”‚  â”‚
â”‚   â”‚         â”‚                                                                     â”‚  â”‚
â”‚   â”‚         â–¼                                                                     â”‚  â”‚
â”‚   â”‚   Check cache: "stock_history_AAPL"                                          â”‚  â”‚
â”‚   â”‚         â”‚                                                                     â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                                              â”‚  â”‚
â”‚   â”‚   â–¼           â–¼                                                              â”‚  â”‚
â”‚   â”‚ [HIT]      [MISS]                                                            â”‚  â”‚
â”‚   â”‚   â”‚           â”‚                                                              â”‚  â”‚
â”‚   â”‚   â”‚           â–¼                                                              â”‚  â”‚
â”‚   â”‚   â”‚    YahooFinance.get("AAPL", from=5yearsAgo, to=today, DAILY)            â”‚  â”‚
â”‚   â”‚   â”‚           â”‚                                                              â”‚  â”‚
â”‚   â”‚   â”‚           â–¼                                                              â”‚  â”‚
â”‚   â”‚   â”‚    Returns: ~1,260 daily OHLCV records                                   â”‚  â”‚
â”‚   â”‚   â”‚           â”‚                                                              â”‚  â”‚
â”‚   â”‚   â”‚           â–¼                                                              â”‚  â”‚
â”‚   â”‚   â”‚    Save to market_cache                                                  â”‚  â”‚
â”‚   â”‚   â”‚           â”‚                                                              â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                              â”‚  â”‚
â”‚   â”‚         â–¼                                                                     â”‚  â”‚
â”‚   â”‚   Return StockHistoryResponse:                                               â”‚  â”‚
â”‚   â”‚   {                                                                          â”‚  â”‚
â”‚   â”‚     ticker: "AAPL",                                                          â”‚  â”‚
â”‚   â”‚     name: "Apple Inc.",                                                      â”‚  â”‚
â”‚   â”‚     price: 182.50,                                                           â”‚  â”‚
â”‚   â”‚     historicalData: [ { date, open, high, low, close, volume }, ... ]       â”‚  â”‚
â”‚   â”‚   }                                                                          â”‚  â”‚
â”‚   â”‚                                                                               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                                             â”‚
â”‚         â–¼                                                                             â”‚
â”‚   Frontend receives all data                                                          â”‚
â”‚         â”‚                                                                             â”‚
â”‚         â”œâ”€â–º Display stock info + current price                                       â”‚
â”‚         â”œâ”€â–º Render Recharts line graph with historical data                          â”‚
â”‚         â”œâ”€â–º Show news articles                                                        â”‚
â”‚         â””â”€â–º Show Buy/Sell buttons                                                     â”‚
â”‚                                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Buy Order Complete Flow

### When User Clicks "BUY 10 shares of AAPL at $182.50"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BUY ORDER - COMPLETE DATABASE FLOW                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                               â”‚
â”‚   User clicks BUY button                                                                      â”‚
â”‚         â”‚                                                                                     â”‚
â”‚         â–¼                                                                                     â”‚
â”‚   Frontend sends:                                                                             â”‚
â”‚   POST /api/orders                                                                            â”‚
â”‚   { "ticker": "AAPL", "orderType": "BUY", "quantity": 10, "price": 182.50 }                  â”‚
â”‚         â”‚                                                                                     â”‚
â”‚         â–¼                                                                                     â”‚
â”‚   OrderController.placeOrder(request)                                                         â”‚
â”‚         â”‚                                                                                     â”‚
â”‚         â–¼                                                                                     â”‚
â”‚   OrderService.placeOrder(request)                                                            â”‚
â”‚         â”‚                                                                                     â”‚
â”‚         â–¼                                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                           DATABASE OPERATIONS (In Order)                             â”‚    â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚   â”‚                                                                                      â”‚    â”‚
â”‚   â”‚   STEP 1: Get Portfolio                                                              â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ SQL: SELECT * FROM portfolios WHERE id = 1                                  â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ Result: { id: 1, name: "Default Portfolio", cash_balance: 100000.00 }      â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚         â”‚                                                                            â”‚    â”‚
â”‚   â”‚         â–¼                                                                            â”‚    â”‚
â”‚   â”‚   STEP 2: Calculate Total                                                            â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ totalAmount = 10 Ã— 182.50 = $1,825.00                                       â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚         â”‚                                                                            â”‚    â”‚
â”‚   â”‚         â–¼                                                                            â”‚    â”‚
â”‚   â”‚   STEP 3: Validate Balance                                                           â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ Is $100,000 >= $1,825?  âœ“ YES - proceed                                    â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ If NO â†’ throw InsufficientFundsException                                    â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚         â”‚                                                                            â”‚    â”‚
â”‚   â”‚         â–¼                                                                            â”‚    â”‚
â”‚   â”‚   STEP 4: Deduct from Cash Balance                                                   â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ SQL: UPDATE portfolios SET cash_balance = 98175.00 WHERE id = 1            â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ New balance: $100,000 - $1,825 = $98,175.00                                â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚         â”‚                                                                            â”‚    â”‚
â”‚   â”‚         â–¼                                                                            â”‚    â”‚
â”‚   â”‚   STEP 5: Check Existing Holding                                                     â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ SQL: SELECT * FROM holdings WHERE portfolio_id = 1 AND ticker = 'AAPL'     â”‚    â”‚    â”‚
â”‚   â”‚   â”‚ Result: NULL (no existing holding) OR existing holding record              â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚         â”‚                                                                            â”‚    â”‚
â”‚   â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚    â”‚
â”‚   â”‚         â”‚                                                 â”‚                         â”‚    â”‚
â”‚   â”‚         â–¼                                                 â–¼                         â”‚    â”‚
â”‚   â”‚   [EXISTING HOLDING]                               [NO EXISTING HOLDING]            â”‚    â”‚
â”‚   â”‚         â”‚                                                 â”‚                         â”‚    â”‚
â”‚   â”‚   STEP 6a: Update Holding                          STEP 6b: Create Holding         â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚   â”‚   â”‚ Calculate new values:   â”‚                     â”‚ SQL: INSERT INTO        â”‚      â”‚    â”‚
â”‚   â”‚   â”‚ Old: 5 shares @ $175    â”‚                     â”‚   holdings (portfolio_idâ”‚      â”‚    â”‚
â”‚   â”‚   â”‚ New: +10 shares @ $182.5â”‚                     â”‚   ticker, quantity,     â”‚      â”‚    â”‚
â”‚   â”‚   â”‚                         â”‚                     â”‚   avg_buy_price,        â”‚      â”‚    â”‚
â”‚   â”‚   â”‚ Total: 15 shares        â”‚                     â”‚   created_at)           â”‚      â”‚    â”‚
â”‚   â”‚   â”‚ New Avg:                â”‚                     â”‚   VALUES (1, 'AAPL',    â”‚      â”‚    â”‚
â”‚   â”‚   â”‚ (5Ã—175 + 10Ã—182.5)/15  â”‚                     â”‚   10, 182.50, NOW())    â”‚      â”‚    â”‚
â”‚   â”‚   â”‚ = $180.00               â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚   â”‚   â”‚                         â”‚                                                       â”‚    â”‚
â”‚   â”‚   â”‚ SQL: UPDATE holdings    â”‚                                                       â”‚    â”‚
â”‚   â”‚   â”‚ SET quantity = 15,      â”‚                                                       â”‚    â”‚
â”‚   â”‚   â”‚ avg_buy_price = 180.00  â”‚                                                       â”‚    â”‚
â”‚   â”‚   â”‚ WHERE id = [holding_id] â”‚                                                       â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚    â”‚
â”‚   â”‚         â”‚                                                 â”‚                         â”‚    â”‚
â”‚   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚    â”‚
â”‚   â”‚                               â”‚                                                      â”‚    â”‚
â”‚   â”‚                               â–¼                                                      â”‚    â”‚
â”‚   â”‚   STEP 7: Create Order Record                                                        â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚   â”‚   â”‚ SQL: INSERT INTO orders                                                     â”‚    â”‚    â”‚
â”‚   â”‚   â”‚   (portfolio_id, ticker, order_type, status, quantity, price,              â”‚    â”‚    â”‚
â”‚   â”‚   â”‚    total_amount, created_at, executed_at)                                  â”‚    â”‚    â”‚
â”‚   â”‚   â”‚   VALUES (1, 'AAPL', 'BUY', 'COMPLETED', 10, 182.50, 1825.00,              â”‚    â”‚    â”‚
â”‚   â”‚   â”‚           '2026-02-04 21:00:00', '2026-02-04 21:00:00')                    â”‚    â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚   â”‚                                                                                      â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                                                                                     â”‚
â”‚         â–¼                                                                                     â”‚
â”‚   Return OrderResponse:                                                                       â”‚
â”‚   { id: 1, ticker: "AAPL", orderType: "BUY", status: "COMPLETED", quantity: 10, ... }        â”‚
â”‚         â”‚                                                                                     â”‚
â”‚         â–¼                                                                                     â”‚
â”‚   Frontend shows success toast: "Order placed successfully!"                                  â”‚
â”‚                                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. All API & Cache Usage

### External API Endpoints Used

| API | URL | When Called | Cached? | TTL |
|-----|-----|-------------|---------|-----|
| **Yahoo Finance** (Java lib) | Internal | Stock quotes, history | DB cache | 5 hrs |
| **Yahoo RSS** | `finance.yahoo.com/rss/topstories` | Market news | DB cache | 1 hr |
| **Yahoo RSS** | `feeds.finance.yahoo.com/rss/2.0/headline?s={ticker}` | Stock news | DB cache | 1 hr |
| **Finnhub Quote** | `finnhub.io/api/v1/quote?symbol={ticker}` | Fallback for Yahoo | In-memory | 5 min |
| **Finnhub News** | `finnhub.io/api/v1/company-news?symbol={ticker}` | Fallback news | DB cache | 1 hr |
| **MFAPI** | `api.mfapi.in/mf` | Mutual funds | DB cache | 12 hrs |

### Cache Key Mapping

| Cache Key Pattern | Stored In | TTL | Contains |
|-------------------|-----------|-----|----------|
| `top_gainers` | market_cache table | 5 hours | Top 5 gaining stocks JSON |
| `top_losers` | market_cache table | 5 hours | Top 5 losing stocks JSON |
| `trending_stocks` | market_cache table | 5 hours | 8 trending stocks JSON |
| `market_indices` | market_cache table | 5 hours | S&P, NASDAQ, DOW JSON |
| `market_news` | market_cache table | 1 hour | 10 news articles JSON |
| `stock_news_{TICKER}` | market_cache table | 1 hour | Stock-specific news JSON |
| `stock_history_{TICKER}` | market_cache table | 5 hours | 5-year OHLCV data JSON |
| `mutual_funds` | market_cache table | 12 hours | Fund list JSON |
| `{TICKER}_price` | In-memory HashMap | 5 minutes | Price response object |
| `investmentRibbon_cache` | Frontend sessionStorage | 5 minutes | Holdings + prices |

---

## 7. Complete Caching Strategy

### Three-Layer Cache Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CACHE DECISION FLOW                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                              â”‚
â”‚   User Request Arrives                                                                       â”‚
â”‚         â”‚                                                                                    â”‚
â”‚         â–¼                                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                      LAYER 1: FRONTEND CACHE (sessionStorage)                      â”‚    â”‚
â”‚   â”‚                                    TTL: 5 minutes                                  â”‚    â”‚
â”‚   â”‚                                                                                    â”‚    â”‚
â”‚   â”‚   Check: sessionStorage.getItem('cacheKey')                                       â”‚    â”‚
â”‚   â”‚   Check: Is (now - timestamp) < 5 minutes?                                        â”‚    â”‚
â”‚   â”‚                                                                                    â”‚    â”‚
â”‚   â”‚   Components using this:                                                          â”‚    â”‚
â”‚   â”‚   â€¢ MarketPulse (gainers/losers)                                                  â”‚    â”‚
â”‚   â”‚   â€¢ TrendingStocks                                                                â”‚    â”‚
â”‚   â”‚   â€¢ InvestmentsRibbon (holdings)                                                  â”‚    â”‚
â”‚   â”‚   â€¢ ExplorePage (all data)                                                        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚              â–¼                                 â–¼                                           â”‚
â”‚         [HIT]                             [MISS]                                           â”‚
â”‚         Return cached                          â”‚                                           â”‚
â”‚         NO API call                            â–¼                                           â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                               â”‚          LAYER 2: IN-MEMORY CACHE (HashMap)               â”‚â”‚
â”‚                               â”‚                      TTL: 5 minutes                       â”‚â”‚
â”‚                               â”‚                                                           â”‚â”‚
â”‚                               â”‚   Used by: YahooFinanceService for price caching         â”‚â”‚
â”‚                               â”‚                                                           â”‚â”‚
â”‚                               â”‚   Code:                                                   â”‚â”‚
â”‚                               â”‚   ConcurrentHashMap<String, CachedPrice> priceCache      â”‚â”‚
â”‚                               â”‚                                                           â”‚â”‚
â”‚                               â”‚   Check: priceCache.get(ticker)                          â”‚â”‚
â”‚                               â”‚   Check: Is cached.timestamp + 5min > now?               â”‚â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                        â”‚                                   â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                               â–¼                                                  â–¼         â”‚
â”‚                          [HIT]                                              [MISS]        â”‚
â”‚                          Return price                                            â”‚         â”‚
â”‚                          NO external API                                         â–¼         â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                              â”‚       LAYER 3: DATABASE CACHE             â”‚â”‚
â”‚                                              â”‚           (market_cache table)            â”‚â”‚
â”‚                                              â”‚                                           â”‚â”‚
â”‚                                              â”‚   TTLs:                                   â”‚â”‚
â”‚                                              â”‚   â€¢ Market data: 5 hours (300 min)       â”‚â”‚
â”‚                                              â”‚   â€¢ News: 1 hour (60 min)                â”‚â”‚
â”‚                                              â”‚   â€¢ Mutual funds: 12 hours               â”‚â”‚
â”‚                                              â”‚                                           â”‚â”‚
â”‚                                              â”‚   Code:                                   â”‚â”‚
â”‚                                              â”‚   cacheRepository.findByCacheKey(key)    â”‚â”‚
â”‚                                              â”‚   cached.isExpired(TTL_MINUTES)          â”‚â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                       â”‚                   â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                                              â–¼                               â–¼           â”‚
â”‚                                         [HIT]                           [MISS]          â”‚
â”‚                                         Return JSON                          â”‚           â”‚
â”‚                                         from cache_value                     â–¼           â”‚
â”‚                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                                          â”‚    EXTERNAL API CALL        â”‚â”‚
â”‚                                                          â”‚                             â”‚â”‚
â”‚                                                          â”‚  Yahoo Finance              â”‚â”‚
â”‚                                                          â”‚       â”‚                     â”‚â”‚
â”‚                                                          â”‚  [Failed?]                  â”‚â”‚
â”‚                                                          â”‚       â–¼                     â”‚â”‚
â”‚                                                          â”‚  Finnhub API                â”‚â”‚
â”‚                                                          â”‚       â”‚                     â”‚â”‚
â”‚                                                          â”‚  [Failed?]                  â”‚â”‚
â”‚                                                          â”‚       â–¼                     â”‚â”‚
â”‚                                                          â”‚  Mock Data                  â”‚â”‚
â”‚                                                          â”‚                             â”‚â”‚
â”‚                                                          â”‚  Save result to all caches  â”‚â”‚
â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cache Benefits

| Without Cache | With Cache |
|---------------|------------|
| Every page load = 5-10 API calls | First load only = API calls |
| Yahoo rate limit hit quickly (429) | Rate limit rarely hit |
| Slow page loads (500ms-2s per API) | Fast loads (<100ms from cache) |
| External API costs money | Minimal API costs |
